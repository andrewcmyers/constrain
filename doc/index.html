<html>
<head>
  <script src="../numeric-1.2.6.js"></script>
  <script src="../constrain.js"></script>
  <style>
    canvas {
        background-color: transparent;
        max-width: 100%; width: 200px; height: 200px;
    }
    h1, h2 { font-family: Optima, sans-serif; text-align: center; color: #008 }
    h3, h4 { font-family: Optima, sans-serif; color: #008 }
    h1 { font-size: 400% }
    h2 { font-size: 300% }
    h3 { font-size: 150% }
    h4 { font-size: 120% }
    div.content { max-width: 100ex; margin: 4em auto }   
    body  {background-color: fed }
    p, ul li { font-size: 12pt; font-family: Palatino, serif }       
    pre.code { padding: 1ex; font-size: 10pt; width: 60ex; float:right; border: 1px solid black; background-color: #ddd; font-family: Menlo, fixed }

</style>
  
</head>
<body>

<script>
  function elem(id) { return document.getElementById(id) }
  function show_example(pre_id, div_id) {
    elem(pre_id).innerText = elem(div_id).outerHTML
        .replace(/^.*\n/, "")
        .replace(/<\/div>$/, "")


  }
</script>

<div class=content>
<h1>Constrain</h1>
<h2>Constraint-Based Animated Figures for Web Pages</h2>

<p>
  Constrain is designed for adding diagrams to web pages and
  web-based presentations. It has some advantages over
  alternative ways to generate diagrams:
  <ul>
    <li>Constrain draws figures onto HTML canvases, so diagrams are
        resolution-independent and as crisp as possible on all displays.
    <li>Constrain supports animated figures in which displayed objects move and change
        their appearance smoothly or discontinuously. To make animations smooth,
        it uses a fast solver based on backpropagation.
    <li>Constrain is based on declaring constraints that are automatically
        solved. This makes it is easy to produce very precise diagrams,
        and makes it easier to build and modify complex diagrams.
    <li>Constrain includes an integration for the Reveal.js web-based presentation
        framework, so you can use it for presentations too.
  </ul>
  Constrain is written in JavaScript (ECMAScript 6) and integrates into web
  pages in most modern browsers.
</p>
<p>
  This page is intended to be a reference manual for Constrain. It is a work in 
  progress and not all features are covered yet.
<h2>Overview</h2>
<p>
  Here is a very simple Constrain diagram, generated by the code on the right:
</p>

<pre id="example1_code" class=code></pre>
<div id="example1">
<canvas id=fig1>Example figure</canvas>
<script>
  with (new Constrain.Figure("fig1")) {
    setLineWidth(3)
    let sq = square(),
        c = circle().setFillStyle("#cdf")
                    .at(sq.lr())
    label("circle", 18).at(c)
  }
</script>
</div>
<script>
    show_example("example1_code", "example1")
</script>

<p>
All Constrain resources are accessed via the global <code>Constrain</code> object. For example,
the class <code>Figure</code> can be named as <code>Constrain.Figure</code>. For brevity,
the <code>Constrain.</code> qualifier is often omitted in this document.
</p>
<p>
A figure is created by instantiating the class <code>Figure</code> with the identifier
attribute of the canvas in which the figure is to appear, or with the canvas object itself.
In the example above, the canvas is named <code>"fig1"</code>, so this attribute is passed
to the <code>Figure</code> constructor.
</p>
<p>
Typically, the methods of <code>Figure</code> are used to define graphical objects to appear
in the figure, constraints to govern their size and placement, and possibly animation frame
information to specify how the graphical objects and constraints change over time. In
the example above, these methods are invoked implicitly on the new <code>Figure</code> object
because of the <code>with</code> statement; it turns out to be convenient for use with Constrain.
The <code>square</code> and <code>circle</code> methods create graphical objects to be displayed
in the figure. Both of them inherit the figure's default line width of 3; the circle overrides
the fill color to be light blue by calling <code>setFillStyle</code>. The second method call on
the circle introduces constraints to position the cricle at the lower right corner of the square.
Note that graphical objects support cascaded method calls; the result of <code>setFillStyle</code>
is simply the circle itself.
</p>

<h2>Graphical objects</h2>

<p>
Constrain supports a number of useful graphical objects that support a common
API for defining their appearance. The <code>Figure</code> class provides
convenience methods for creating these objects, although they can also be
created by invoking the constructors of the corresponding classes.  Constrain
can be extended with new user-defined graphical objects, using the full power
of HTML canvases to produce desired graphical effects. 
</p>
<p>
Graphical objects are drawn in the order in which they are declared, so objects
created later may cover those created earlier. In this respect, figures are not
fully declarative.
</p>

<h3>Shapes</h3>

<h4><code>rectangle([fillStyle], [strokeStyle], [lineWidth])</code></h4>
<p>
A rectangle object (class <code>Rectangle</code>). The default fill style, stroke style,
and line width of the figure may optionally be overridden by providing these parameters.

<pre id="rectangle_ex_code" class=code></pre>
<div id="rectangle_ex">
<canvas id=rectangle_ex_fig></canvas>
<script>
  with (new Constrain.Figure("rectangle_ex_fig")) {
    const grd = ctx.createLinearGradient(0, 0, 100, 100)
    grd.addColorStop(0, "red")
    grd.addColorStop(1, "blue")
    rectangle().setFillStyle(grd)
               .setLineWidth(4)
               .setCornerRadius(10)
  }
</script>
</div>
<script>
    show_example("rectangle_ex_code", "rectangle_ex")
</script>

<h4><code>square([fillStyle], [strokeStyle], [lineWidth])</code></h4>
<p>
A square (class <code>Square</code>), which is just a rectangle
constrained to have equal dimensions. The default fill style, stroke style, and
line width of the figure may optionally be overridden by providing these
parameters.

<h4><code>ellipse([fillStyle], [strokeStyle], [lineWidth])</code></h4>
<p>
An axis-aligned ellipse (class <code>Ellipse</code>).  The default fill
style, stroke style, and line width of the figure may optionally be overridden
by providing these parameters.

<pre id="ellipse_ex_code" class=code></pre>
<div id="ellipse_ex">
<canvas id=ellipse_ex_fig></canvas>
<script>
  with (new Constrain.Figure("ellipse_ex_fig")) {
    let e = ellipse().setFillStyle("#fde")
    equal(e.width(), times(2, e.height()),
          canvasRect().inset(2).width())
  }
</script>
</div>
<script>
    show_example("ellipse_ex_code", "ellipse_ex")
</script>

<h4><code>circle([fillStyle], [strokeStyle], [lineWidth])</code></h4>
<p>
A circle object (class <code>Circle</code>), which is just an ellipse
constrained to have equal dimensions. The default fill style, stroke style, and
line width of the figure may optionally be overridden by providing these
parameters.

<h4><code>polygon(points, [fillStyle], [strokeStyle], [lineWidth])</code></h4>
<p>
A closed polygon connecting the given array of points (class <code>Polygon</code>).

<pre id="polygon_ex_code" class=code></pre>
<div id="polygon_ex">
<canvas id=polygon_ex_fig></canvas>
<script>
  with (new Constrain.Figure("polygon_ex_fig")) {
    let p1 = point(), p2 = point(), p3 = point()
    equal(100, distance(p1, p2),
          distance(p2, p3), distance(p1, p3))
    equal(p2.y(), p3.y())
    polygon([p1, p2, p3], "#dfd")
  }
</script>
</div>
<script>
    show_example("polygon_ex_code", "polygon_ex")
</script>

<h3>Lines</h3>

<h4><code>line([strokeStyle], [lineWidth])</code></h4>
<p>
Creates a straight line whose appearance can be overridden with optional
parameters (class <code>Line</code>).  Its position is defined by adding constraints on the points
returned by its <code>p1()</code> and <code>p2()</code> methods. It can also be
given arrowheads.
</p>

<h4><code>horzLine([strokeStyle], [lineWidth])</code></h4>
<p>
Creates a straight horizontal line (class <code>HorzLine<code>).
</p>

<h4><code>vertLine([strokeStyle], [lineWidth])</code></h4>
<p>
Creates a straight vertical line (class <code>VertLine<code>).
</p>

<h4><code>connector(...objects)</code></h4>
<p>
Connectors (class <code>Connector</code>) are often the easiest way to draw a line. A connector is a smooth
curve connecting the specified list of objects. Typically, the goal is to
connect the objects at the beginning and end of the list, with the intermediate
objects (often <code>Point</code>s) serving as control points to guide the
shape of the curve. Connectors act like Bezier splines near their endpoints but
like B-splines (which are smoother) in the middle. 
</p>

<pre id="connector_ex_code" class=code></pre>
<div id="connector_ex">
<canvas id=connector_ex_fig></canvas>
<script>
  with (new Constrain.Figure("connector_ex_fig")) {
    let c1 = circle().setW(30).at(point(30, 100)),
        c2 = circle().setW(30).at(c1.toRight(100))
    connector(c1, average(c1, c2).toTop(20), c2)
        .setEndArrow("arrow")
  }
</script>
</div>
<script>
    show_example("connector_ex_code", "connector_ex")
</script>

<h3>Text</h3>

<h4><code>label(text, [fontSize], [fontName], [fillStyle])</code></h4>
<p>
Creates a graphical object that is a simple line of text.
</p>

<h4><code>textFrame(text, [fillStyle])</code></h4>
<p>
Creates a graphical object that is a box containing text. The text is automatically reformatted
to fit within the box. Note that several other graphical objects, such as rectangles and circles,
support adding text with similar formatting capability.
</p>

<h4><code>lineLabel(text, position, [offset], [fontSize], [fontName], [fillStyle])</code></h4>
<p>
Creates a label containing the given text, positioned somewhere along a line or connector. The
position is a number from 0 to 1, representing how far along the connector the label is placed.
The optional <code>offset</code> parameter specifies how far to the starboard
side of the connector the label is placed.  It is added to a connector using the connector's
<code>addLabel</code> method.
</p>
<pre id="linelabel_ex_code" class=code></pre>
<div id="linelabel_ex">
<canvas id=linelabel_ex_fig></canvas>
<script>
  with (new Constrain.Figure("linelabel_ex_fig")) {
    let c1 = square().setW(30).at(point(30, 100)),
        c2 = square().setW(30).at(c1.toRight(100))
    connector(c1, average(c1, c2).toTop(20), c2)
        .setEndArrow("arrow")
        .addLabel(lineLabel("label", 0.5, 5))
  }
</script>
</div>
<script>
    show_example("linelabel_ex_code", "linelabel_ex")
</script>

<h3>Interactive objects</h3>

<h4><code>handle(style)</code></h4>
<p>
A handle (class <code>Handle</code>) is an object that can be moved using the mouse,
affecting any constraints that depend on its position. The following example dynamically
circumscribes a triangle; you can draw the diamond-shaped handle to change the figure.
</p>

<pre id="handle_ex_code" class=code></pre>
<div id="handle_ex">
<canvas id=handle_ex_fig></canvas>
<script>
  with (new Constrain.Figure("handle_ex_fig")) {
    let c = circle("#def"), h1 = handle(),
        h2 = point(150, 150), h3 = point(50, 150)
    h1.x().setHint(20); h1.y().setHint(20)
    polygon([h1, h2, h3])
    equal(distance(c, h1), distance(c, h2),
          distance(c, h3))
    c.setW(times(2, distance(c, h1)))
  }
</script>
</div>
<script>
    show_example("handle_ex_code", "handle_ex")
</script>


<h4><code>advanceButton()</code></h4>
<p>
A button that can be used to advance the current state of the animation.
</p>

<pre id="advance_ex_code" class=code></pre>
<div id="advance_ex">
<canvas id=advance_ex_fig></canvas>
<script>
  with (new Constrain.Figure("advance_ex_fig")) {
    const f0 = addFrame(), f1 = addFrame(),
          f2 = addFrame(), f3 = addFrame()
    setRepeat(true); setFadeColor("#fed")
    setFillStyle("yellow")
    group(drawAfter(f1, square().addText("1")),
          drawAfter(f2, square().addText("2")),
          drawAfter(f3, square().addText("3")))
      .setH(30)
      .align("abut", "top bottom")
    align("right", "bottom",
          advanceButton(), canvasRect().inset(2))
  }
</script>
</div>
<script>
    show_example("advance_ex_code", "advance_ex")
</script>

<h3>Unrendered objects</h3>
<p>
Some figure elements act like graphical objects in most respects but do not result in 
any rendering. These objects are useful for positioning other objects.
</p>

<h4><code>point()</code></h4>
<p>
Creates a point (class <code>Point</code>) at an unspecified location. Its
location is solved for.
</p>

<h4><code>point(x, y)</code></h4>
<p>
Creates a point (class <code>Point</code>) at the location (x,y). This is
equivalent to <code>point().at(x,y)
</p>

<h4><code>box()</code></h4>
<p>
A box (class <code>Box</code>) is an axis-aligned rectangle that has no
rendering. In other respects it acts like a graphical object; for example, it
has a width and height.
</p>

<h4><code>hspace(w)</code></h4>
<p>
Horizontal space. It has width <code>w</code> but zero height.
</p>

<h4><code>vspace(h)</code></h4>
<p>
Vertical space. It has height <code>h</code> but zero width.
</p>

<h4><code>DOMElement(id)</code></h4>
<p>
A box with position and the size of the DOM element with the specified id
attribute (class <code>DOMElementBox</code>).  This feature helps overlay
graphics onto regular web page content.
</p>
<h4><code>group(...objects)</code></h4>
<p>
A box containing a set of objects. The box is just large enough to surround all the objects.
</p>
<h4><code>variable(name)</code></h4>
<p>
Creates a fresh variable that can be solved for. Its name is based on the <code>name</code>
parameter.
</p>

<h3>User-defined graphical objects</h3>
<p>
The class <code>UserDefined</code> provides a template for building new graphical objects.
By default, a user-defined object is drawn as a plain gray square.
It is the responsibility of the user to define a subclass of <code>UserDefined</code>, in
which the following method is overridden:

<h4><code>draw(context, frame, time, x0, y0, x1, y1)</code></h4>

<p>
Draw a user-defined object in the graphical context <code>context</code>. The current
animation frame is <code>frame</code> and the time (0â€“1) within that frame is <code>time</code>.
The parameters <code>x0</code>, <code>y0</code>, <code>x1</code>, <code>y1</code> define the
box that nominally contains the object.
</p>
<h3>Methods for adding constraints</h3>

<h3>Positions</h3>

<h3>Graphs</h3>

<h3>Animation</h3>




<script>
  for (f in Constrain.Figures) {
    Constrain.Figures[f].start()
  }
</script>
</div>
</body>
</html>
